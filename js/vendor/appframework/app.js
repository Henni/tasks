
/**
 * ownCloud App Framework - v0.0.1
 *
 * Copyright (c) 2014 - Bernhard Posselt <dev@bernhard-posselt.com>
 *
 * This file is licensed under the Affero General Public License version 3 or later.
 * See the COPYING-README file
 *
 */


// Generated by CoffeeScript 1.7.1

/*

ownCloud - App Framework

@author Bernhard Posselt
@copyright 2012 Bernhard Posselt dev@bernhard-posselt.com

This library is free software; you can redistribute it and/or
modify it under the terms of the GNU AFFERO GENERAL PUBLIC LICENSE
License as published by the Free Software Foundation; either
version 3 of the License, or any later version.

This library is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU AFFERO GENERAL PUBLIC LICENSE for more details.

You should have received a copy of the GNU Affero General Public
License along with this library.  If not, see <http://www.gnu.org/licenses/>.
 */

(function() {
  angular.module('OC', []).config([
    '$httpProvider', function($httpProvider) {
      return $httpProvider.defaults.headers.common['requesttoken'] = oc_requesttoken;
    }
  ]);

}).call(this);



(function() {
  angular.module('OC').factory('_Model', function() {
    var Model;
    Model = (function() {
      function Model() {
        this._data = [];
        this._dataMap = {};
        this._filterCache = {};
      }

      Model.prototype.handle = function(data) {

        /*
        			Redirects to add method
         */
        var item, _i, _len, _results;
        _results = [];
        for (_i = 0, _len = data.length; _i < _len; _i++) {
          item = data[_i];
          _results.push(this.add(item));
        }
        return _results;
      };

      Model.prototype.add = function(data, clearCache) {
        if (clearCache == null) {
          clearCache = true;
        }

        /*
        			Adds a new entry or updates an entry if the id exists already
         */
        if (clearCache) {
          this._invalidateCache();
        }
        if (angular.isDefined(this._dataMap[data.id])) {
          return this.update(data, clearCache);
        } else {
          this._data.push(data);
          return this._dataMap[data.id] = data;
        }
      };

      Model.prototype.update = function(data, clearCache) {
        var entry, key, value, _results;
        if (clearCache == null) {
          clearCache = true;
        }

        /*
        			Update an entry by searching for its id
         */
        if (clearCache) {
          this._invalidateCache();
        }
        entry = this.getById(data.id);
        _results = [];
        for (key in data) {
          value = data[key];
          if (key === 'id') {
            continue;
          } else {
            _results.push(entry[key] = value);
          }
        }
        return _results;
      };

      Model.prototype.getById = function(id) {

        /*
        			Return an entry by its id
         */
        return this._dataMap[id];
      };

      Model.prototype.getAll = function() {

        /*
        			Returns all stored entries
         */
        return this._data;
      };

      Model.prototype.removeById = function(id, clearCache) {
        var counter, data, entry, _i, _len, _ref;
        if (clearCache == null) {
          clearCache = true;
        }

        /*
        			Remove an entry by id
         */
        _ref = this._data;
        for (counter = _i = 0, _len = _ref.length; _i < _len; counter = ++_i) {
          entry = _ref[counter];
          if (entry.id === id) {
            this._data.splice(counter, 1);
            data = this._dataMap[id];
            delete this._dataMap[id];
            if (clearCache) {
              this._invalidateCache();
            }
            return data;
          }
        }
      };

      Model.prototype.clear = function() {

        /*
        			Removes all cached elements
         */
        this._data.length = 0;
        this._dataMap = {};
        return this._invalidateCache();
      };

      Model.prototype._invalidateCache = function() {
        return this._filterCache = {};
      };

      Model.prototype.get = function(query) {

        /*
        			Calls, caches and returns filtered results
         */
        var hash;
        hash = query.hashCode();
        if (!angular.isDefined(this._filterCache[hash])) {
          this._filterCache[hash] = query.exec(this._data);
        }
        return this._filterCache[hash];
      };

      Model.prototype.size = function() {

        /*
        			Return the number of all stored entries
         */
        return this._data.length;
      };

      return Model;

    })();
    return Model;
  });

}).call(this);


(function() {
  angular.module('OC').factory('_Request', function() {
    var Request;
    Request = (function() {
      function Request(_$http, _publisher) {
        this._$http = _$http;
        this._publisher = _publisher;
        this._initialized = false;
        this._shelvedRequests = [];
        this._initialized = true;
        this._executeShelvedRequests();
        this._shelvedRequests = [];
      }

      Request.prototype.request = function(route, data) {
        var defaultConfig, defaultData, url;
        if (data == null) {
          data = {};
        }

        /*
        			Wrapper to do a normal request to the server. This needs to
        			be done to hook the publisher into the requests and to handle
        			requests, that come in before routes have been loaded
        
        			route: the routename data can contain the following
        			data.routeParams: object with parameters for the route
        			data.data: ajax data objec which is passed to PHP
        			data.onSuccess: callback for successful requests
        			data.onFailure: callback for failed requests
        			data.config: a config which should be passed to $http
         */
        defaultData = {
          routeParams: {},
          data: {},
          onSuccess: function() {},
          onFailure: function() {},
          config: {}
        };
        angular.extend(defaultData, data);
        if (!this._initialized) {
          this._shelveRequest(route, defaultData);
          return;
        }
        if(angular.isUndefined(OC.generateUrl)){
          OC.generateUrl = function(url, params) {
            var _build = function (text, vars) {
              return text.replace(/{([^{}]*)}/g,
                function (a, b) {
                  var r = vars[b];
                  return typeof r === 'string' || typeof r === 'number' ? r : a;
                }
                );
            };
            if (url.charAt(0) !== '/') {
              url = '/' + url;
            }
            return OC.webroot + '/index.php' + _build(url, params);
          }
        }


        url = OC.generateUrl(route, defaultData.routeParams);
        defaultConfig = {
          url: url,
          data: defaultData.data
        };
        angular.extend(defaultConfig, defaultData.config);
        if (defaultConfig.method === 'GET') {
          defaultConfig.params = defaultConfig.data;
        }
        return this._$http(defaultConfig).success((function(_this) {
          return function(data, status, headers, config) {
            var name, value, _ref;
            _ref = data.data;
            for (name in _ref) {
              value = _ref[name];
              _this._publisher.publishDataTo(value, name);
            }
            return defaultData.onSuccess(data, status, headers, config);
          };
        })(this)).error(function(data, status, headers, config) {
          return defaultData.onFailure(data, status, headers, config);
        });
      };

      Request.prototype.post = function(route, data) {
        if (data == null) {
          data = {};
        }

        /*
        			Request shortcut which sets the method to POST
         */
        data.config || (data.config = {});
        data.config.method = 'POST';
        return this.request(route, data);
      };

      Request.prototype.get = function(route, data) {
        if (data == null) {
          data = {};
        }

        /*
        			Request shortcut which sets the method to GET
         */
        data.config || (data.config = {});
        data.config.method = 'GET';
        return this.request(route, data);
      };

      Request.prototype.put = function(route, data) {
        if (data == null) {
          data = {};
        }

        /*
        			Request shortcut which sets the method to GET
         */
        data.config || (data.config = {});
        data.config.method = 'PUT';
        return this.request(route, data);
      };

      Request.prototype["delete"] = function(route, data) {
        if (data == null) {
          data = {};
        }

        /*
        			Request shortcut which sets the method to GET
         */
        data.config || (data.config = {});
        data.config.method = 'DELETE';
        return this.request(route, data);
      };

      Request.prototype._shelveRequest = function(route, data) {

        /*
        			Saves requests for later if the routes have not been loaded
         */
        var request;
        request = {
          route: route,
          data: data
        };
        return this._shelvedRequests.push(request);
      };

      Request.prototype._executeShelvedRequests = function() {

        /*
        			Run all saved requests that were done before routes were fully
        			loaded
         */
        var r, _i, _len, _ref, _results;
        _ref = this._shelvedRequests;
        _results = [];
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          r = _ref[_i];
          _results.push(this.request(r.route, r.data));
        }
        return _results;
      };

      return Request;

    })();
    return Request;
  });

}).call(this);


(function() {
  angular.module('OC').factory('_Publisher', function() {
    var Publisher;
    Publisher = (function() {
      function Publisher() {
        this._subscriptions = {};
      }

      Publisher.prototype.subscribeObjectTo = function(object, name) {
        var _base;
        (_base = this._subscriptions)[name] || (_base[name] = []);
        return this._subscriptions[name].push(object);
      };

      Publisher.prototype.publishDataTo = function(data, name) {
        var subscriber, _i, _len, _ref, _results;
        _ref = this._subscriptions[name] || [];
        _results = [];
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          subscriber = _ref[_i];
          _results.push(subscriber.handle(data));
        }
        return _results;
      };

      return Publisher;

    })();
    return Publisher;
  });

}).call(this);


(function() {
  angular.module('OC').factory('Router', function() {
    return OC.Router;
  });

}).call(this);


(function() {
  angular.module('OC').factory('_Loading', function() {
    var Loading;
    Loading = (function() {
      function Loading() {
        this._count = 0;
      }

      Loading.prototype.increase = function() {
        return this._count += 1;
      };

      Loading.prototype.decrease = function() {
        return this._count -= 1;
      };

      Loading.prototype.getCount = function() {
        return this._count;
      };

      Loading.prototype.isLoading = function() {
        return this._count > 0;
      };

      return Loading;

    })();
    return Loading;
  });

}).call(this);